{% extends 'base.html' %} {% block header %} {% include 'network/user_public_header.html' %} {% endblock %} {% load readmore el_pagination_tags staticfiles %} {% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/timeline_app.css' %}" /> {% endblock %} {% block subheader %} {% include "subheader.html"%} {% endblock subheader %}
{% block main %}
    {% include 'timeline/timelineitem_list.html' %}
{% endblock main %}
{% block right %}
<div class="content-right">
    <div class="box">
        <div class="header">{{ view_user.profile.get_display_name }}</div>
        <div class="box-content">
            <div class="row">Member since: {{view_user.profile.create_date |date:"M d, Y"}}</div>
            <div class="row"> Posts: 150 </div>
            <div class="row"> Following: {{following_count}}</div>
            <div id="follower_count" class="row"> Followers: {{follower_count}}</div>
        </div>
    </div>
 {% if user.is_authenticated %}
 {% if user.id != view_user.id %}
    <div class="button" style="width:98px;text-align:center;">
        Send a Note
    </div>

    <form id="unfollow" action="{% url 'user_unfollow' view_user.pk %}">
        {% csrf_token %}
        <div id="unfollow_button" class="button" style="width:98px;text-align:center;">
            Unfollow</div>
    </form>

    <form id="follow" action="{% url 'user_follow' view_user.pk %}">
        {% csrf_token %}
        <div id="follow_button" class="button" style="width:98px;text-align:center;">
            Follow</div>
    </form>
{% endif %}
{% else %}
    <div class="button" style="width:98px;text-align:center;" onClick="window.location = '{%  url 'userena_signin'  %}'">
        Send a Note
    </div>
    <div id="follow_button_login" class="button" style="width:98px;text-align:center;" onClick="window.location = '{%  url 'userena_signin'  %}'">
        Follow</div>
{% endif %}


    <div class="clear-both"></div>
</div>

{% endblock right %} {% block extra_js %}
	{% include 'timeline/timeline_js.html' %}
<script type="text/javascript">
    $(function() {
        var hasFollowed = "{{ has_followed }}";
        if (hasFollowed.toUpperCase() === 'TRUE') {
            $('#unfollow').show();
            $('#follow').hide();
        } else {
            $('#unfollow').hide();
            $('#follow').show();
        }
        var authenticated = "{{ has_followed }}";

        $('#follow_button').click(function() {
            var form = $('#follow');
            $.ajax({
                type: 'POST',
                url: form.attr('action'),
                data: form.serialize(),
                success: function(data) {
                    $('#unfollow').show();
                    $('#follow').hide();
                    $('#follower_count').html( 'Followers: ' +data.follower_count);
                }
            });
        });

        $('#unfollow_button').click(function() {
            var form = $('#unfollow');
            $.ajax({
                type: 'POST',
                url: form.attr('action'),
                data: form.serialize(),
                success: function(data) {
                    $('#unfollow').hide();
                    $('#follow').show();
                    $('#follower_count').html( 'Followers: ' +data.follower_count);
                }
            });
        });
    });
</script>

{% endblock %}
